[gcode_macro M600]
gcode:
  {% set config = printer["gcode_macro _nb_config"] %}
  {% set extruder_temp = params.EXTRUDER|default(210)|float %}
  {% set speed = printer["gcode_macro _filament_temps"].speed %}

  G90
  TOOLHEAD_FRONT
  BEEP

  G1 E100 F{speed}
  G1 E20 F{speed}
  M106 S200
  G1 E-5 F{speed} # retract a little to avoid oozing
  
  BEEP
  BEEP

[gcode_macro _TEMP_UNLOAD_FILAMENT]
gcode:
  {% set extruder_temp = params.EXTRUDER|default(210)|float %}
  {% set speed = printer["gcode_macro _filament_temps"].speed %}
  
  BEEP
  CG28
  SERVICE_Z
  TOOLHEAD_FRONT
 
  M117 Heating...
  {% if printer['gcode_macro _HEATING_DISPLAY'] is defined %}
    _HEATING_DISPLAY
  {% endif %}
  M109 S{extruder_temp}

  M83
  M117 Ramming...
  {% if printer['gcode_macro _UNLOADING_DISPLAY'] is defined %}
    _UNLOADING_DISPLAY
  {% endif %}
  BEEP
  G1 E-100 F{speed}
  G1 E-75 F{speed}
  BEEP
  BEEP

  M104 S0
  {% if printer['gcode_macro _COOLING_DISPLAY'] is defined %}
    _COOLING_DISPLAY
  {% endif %}